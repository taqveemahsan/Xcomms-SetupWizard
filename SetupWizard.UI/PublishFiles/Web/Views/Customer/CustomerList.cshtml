@model IEnumerable<XCommsWeb.Models.CustomerViewModel>
@{
    ViewBag.Title = "Customer List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style type="text/css">
    .mrgleft5 {
        margin-left: 5px
    }

    .mrgleft10 {
        margin-left: 10px
    }

    .mrgtop10 {
        margin-top: 10px
    }

    .mrgtop20 {
        margin-top: 20px
    }

    .dropdown-menu > li > a:focus, .dropdown-menu > li > a:hover {
        text-decoration: none;
        color: #fff;
        background-color: #a90329 !important;
    }

    .btn-primary.active, .btn-primary:active, .btn-primary:focus, .btn-primary:hover, .open > .dropdown-toggle.btn-primary {
        color: #fff;
        background-color: #a90329;
        border-color: #a90329;
    }

    .modal-header .close {
        margin-top: -20px;
    }

    .squarered {
        height: 10px;
        width: 10px;
        background-color: #a90329;
    }

    .squaregreen {
        height: 10px;
        width: 10px;
        background-color: #739e73;
    }

    .ifAlertPreview {
        position: absolute !important;
        /* top: 0px !important;
            left: 350px !important;*/
        z-index: 99999 !important;
        border: 1px solid #CCC !important;
        border-radius: 10px !important;
        box-shadow: 8px 8px 5px grey !important;
    }

    .dt-toolbar {
        padding: 6px 0px 1px;
    }

    .dt-toolbar-footer {
        border-top: 0px;
    }

    .popup_content {
        width: 2133px;
        height: 1079px;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto;
    }

    #imagepreview {
        width: 101.25%;
        height: 101%;
        top: -0.1%;
        left: -0.7%;
        position: relative;
        /*margin-right: 260px;*/
        z-index: 1000;
        background-color: transparent;
    }

    ._1 {
        object-fit: cover;
    }

    ._2 {
        object-fit: contain;
    }

    ._3 {
        object-fit: fill;
    }

    ._4 {
        object-fit: none;
        object-position: left top;
    }

    ._5 {
        object-fit: none;
    }

    ._6 {
        object-fit: cover;
    }

    .disabled-link {
        pointer-events: none;
        background-color: #b5aeaecc;
        color: unset !important;
    }

    .TxtVerAlign
    {
        vertical-align: middle !important;
    }

    .MainBox
    {
        box-shadow: rgba(14, 30, 37, 0.12) 0px 2px 4px 0px, rgba(14, 30, 37, 0.32) 0px 2px 16px 0px !important;
    }
</style>

@using (Html.BeginForm("", "", FormMethod.Post, new { id = "form_sample" }))
{
    <div class="row">
        <article class="col-sm-12 col-md-12 col-lg-12">
            <div class="jarviswidget jarviswidget-color-darken jarviswidget-sortable" id="wid-id-8" data-widget-editbutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false" data-widget-fullscreenbutton="false" data-widget-togglebutton="false">
                <header>
                    <h2><i class="fa fa-users"></i> Customers List</h2>
                </header>
                <div class="widget-body MainBox">
                    <div class="col-md-12">
                        <div class="pull-left">
                            <ul class="demo-btns">
                                <li>
                                    <a href="javascript:void(0);" id="btnSubmit" class="clsAdd btn btn-labeled btn-primary" rel="tooltip" title="" data-placement="bottom" data-original-title="Add New Customer">
                                        <span class="btn-label"><i class="fa fa-plus"></i></span>Add Customer
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="col-md-12 mrgtop10">
                        <table id="dt_CustomerList" class="table table-striped table-bordered table-hover" width="100%">
                            <thead>
                                <tr>
                                    <th class="text-center"><i class="fa fa-university txt-color-blueDark fa-lg"></i> Company</th>
                                    <th class="text-center"><i class="fa fa-user txt-color-blueDark fa-lg"></i> Name</th>
                                    <th class="text-center"><i class="fa fa-calendar txt-color-blueDark fa-lg"></i> Start Date</th>
                                    <th class="text-center"><i class="fa fa-calendar txt-color-blueDark fa-lg"></i> Expired Date</th>
                                    <th class="text-center"><i class="fa fa-info-circle txt-color-blueDark fa-lg"></i> Purchase/Trial</th>
                                    <th class="text-center"><i class="fa fa-check-circle txt-color-blueDark fa-lg"></i> Active</th>
                                    <th class="text-center"><i class="fa fa-question-circle txt-color-blueDark fa-lg"></i> Days Remanings</th>
                                    <th class="text-center"><i class="fa fa-desktop txt-color-blueDark fa-lg"></i> License</th>
                                    <th class="text-center"><i class="fa fa-laptop txt-color-blueDark fa-lg"></i> Modules</th>
                                    <th class="text-center"><i class="fa fa-pencil-square txt-color-blueDark fa-lg"></i> Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    Html.RenderPartial("_CustomerList", item);
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </article>
    </div>
}

<div class="modal fade" id="exampleModalTbl" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="jarviswidget jarviswidget-color-darken" id="wid-id-1" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false" data-widget-fullscreenbutton="false">
                            <header role="heading">
                                <div class="jarviswidget-ctrls" role="menu"></div>
                                <span class="widget-icon"><i class="fa fa-user"></i></span>
                                <h2>Customer Modules</h2>
                            </header>
                            <div>
                                <table class="mrgtop20 table table-responsive table-bordered table-striped" id="tblData2" width="100%"></table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding:10px !important;">
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        <a href="javascript:void(0);" id="btnSubmit" data-dismiss="modal" class="btn btn-labeled btn-danger" rel="tooltip" title="" data-placement="bottom" data-original-title="Close">
                            <span class="btn-label"><i class="fa fa-close"></i></span>Dismiss
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var FormComponents = function (DomainName) {

        var FormValidate = function (DomainName) {
            $("#contact-form").validate({
                rules: { },
                messages: { },
                errorPlacement: function (error, element) { error.insertAfter(element.parent()); }
            });
        }

        return {
            init: function (DomainName) {
                FormValidate(DomainName);

                $(".ClsModTbl").on("click", function () {
                    var strUrl = DomainName + "/Customer/GetCustomerModule";
                    $.ajax({
                        async: false,
                        type: 'POST',
                        url: strUrl,
                        data: { 'CustomerId': $(this).data('id') },
                        success: function (data) {
                            App.blockUI({ boxed: true });
                            if (data == "1") {

                            } else {
                                $("#tblData2").html(data);
                                $('#exampleModalTbl').modal('show');
                                dataTableById("tblData2");
                            }
                            App.unblockUI();
                        },
                        error: function (jqXHR, exception) {
                            TosterNotification("error", errorResult(jqXHR, exception), "Error");
                        }
                    });
                });

                $(".clsEdit").on("click", function () {
                    App.blockUI({ boxed: true });
                    var Id = $(this).data("customerid");
                    window.location = DomainName + "/Customer/CustomerRegistration?CustomerId=" + Id;

                });
                $('.clsAdd').click(function () {
                    App.blockUI({ boxed: true });
                    window.location = DomainName + "/Customer/CustomerRegistration?CustomerId=0";
                });

                $('.clsBlockUnblockCust').click(function () {
                    App.blockUI({ boxed: true });

                    Swal.fire({
                        title: '<i class="fa fa-user txt-color-blueDark"></i> Are you sure you want to Block/Unblock Customer ?',
                        text: "",
                        icon: 'info',
                        showCancelButton: true,
                        confirmButtonColor: 'green',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes !'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            var strUrl = DomainName + "/Customer/CustomerWiseUsersBlockUnblock";
                            var data = {
                                email: $(this).data("email"),
                                customerid: $(this).data("customerid"),
                                flag: $(this).data("flag")
                            }
                            $.ajax({
                                type: 'GET',
                                url: strUrl,
                                data: data,
                                success: function (data) {

                                    console.log("Result : " + data.result);
                                    console.log("Flag : " + data.UpdateFlag);

                                    if (data.result == "Done") {
                                        Swal.fire("Customer has been " + data.UpdateFlag + " successfully!", '', 'success');
                                        setTimeout(function () {
                                            window.location = DomainName + "/Customer/CustomerList"
                                        }, 1500);
                                        App.unblockUI();
                                    }
                                },
                                error: function (jqXHR, exception) {
                                    Swal.fire(errorResult(jqXHR, exception), '', 'error');
                                    App.unblockUI();
                                }
                            })
                        }
                        else {
                            App.unblockUI();
                            return false;
                        }
                    })
                });

                  if ('@ViewBag.IsExpired' == 1) {
                      $('.clsAdd').hide();
                      $('.clsBlockUnblockCust').addClass('disabled-link');
                }
                dataTableById("dt_CustomerList", 2, 'desc', true);
            }
        }
    }();
</script>