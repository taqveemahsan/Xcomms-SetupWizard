@using XCommsWeb.Models;
@using System.Configuration
@model XCommsWeb.Models.PopAlertViewModel

@{
    ViewBag.Title = "Welcome to ";
    Layout = "~/Views/Shared/_Layout.cshtml";

    string MenuList = "";
    string User_Type = ViewBag.User_Type;
    string[] ststusarray = new string[0];

    //if (ViewBag.PermissionTyp == "Administator")
    //{
    //    MenuList = "6";
    //    ststusarray = MenuList.Split(',');
    //}
    //if (ViewBag.PermissionTyp == "Custom")
    //{
    //    MenuList = ViewBag.ToolList;
    //    ststusarray = MenuList.Split(',');
    //}
    if (ViewBag.PermissionTyp == "ContentManager")
    {
        MenuList = "ContentManager";
        ststusarray = MenuList.Split(',');
    }

    if ((ViewBag.PermissionTyp == "Administator" && User_Type == "Cust") || ViewBag.PermissionTyp == "Custom")
    {
        MenuList = ViewBag.ToolList;

        if (!string.IsNullOrEmpty(MenuList))
        {
            ststusarray = MenuList.Split(',');
        }
    }
    else if (ViewBag.PermissionTyp == "Administator")
    {
        MenuList = "6";
        ststusarray = MenuList.Split(',');
    }

}

<style type="text/css">

  


    .mrgleft5 {
        margin-left: 5px
    }

    .indicator {
        display: inline-block;
        width: 1em;
        height: 1em;
        border-radius: 50%;
    }

    .online {
        -webkit-animation: pulse-animation 3s infinite linear;
    }

    .offline {
        -webkit-animation: pulse-animation 3s infinite linear;
    }

    .squarered {
        height: 10px;
        width: 10px;
        background-color: #a90329;
    }

    .squaregreen {
        height: 10px;
        width: 10px;
        background-color: #739e73;
    }

    .popover-content {
        color: #000000 !important;
    }

    .popover-title {
        font-weight: 700;
        color: #000000 !important;
        background-color: #EEE !important;
    }

    .xcommsToolbar {
        /*font-size: 1rem;*/
        font-size: 14px;
        margin-top: 20px;
    }

    .bggrey {
        background: #404040;
        color: #fff;
    }

    .anlink {
        text-decoration: none;
        color: #a90329;
        transition: 0.2s ease-out;
        font-size: 18px;
        margin-top: -15px;
    }

        .anlink:hover {
            color: #404040;
            text-decoration: none;
            transition: 0.2s ease-in;
        }

    .img-responsive {
        width: 100%;
    }

    @@media screen and (max-width: 1600px) {
        .xcommsToolbar {
            font-size: 12px;
        }
    }
    @@media screen and (max-width: 1400px) {
        .xcommsToolbar {
            font-size: 10px;
        }
    }

    @@media screen and (max-width: 1200px) {
        .xcommsToolbar {
            font-size: 8px;
        }
    }

    .MainBox
    {
        box-shadow: rgba(14, 30, 37, 0.12) 0px 2px 4px 0px, rgba(14, 30, 37, 0.32) 0px 2px 16px 0px !important;
    }
    .img-responsive {
        max-width: 100%;
        height: auto;
        transition: transform 0.3s ease; /* Smooth transition for the scaling effect */
    }

    .img-responsive:hover {
        transform: scale(1.05); /* 1.10 means 110% of the original size, which is a 10% increase */
    }
</style>

<div class="row">
    @*<img src="~/assets/img/ribbon.png" class="ribbon" alt="">*@

    <!-- NEW WIDGET START -->
    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12 sortable-grid ui-sortable">

        <!-- Widget ID (each widget will need unique ID)-->
        <div class="jarviswidget jarviswidget-color-darken jarviswidget-sortable" id="wid-id-0" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false" data-widget-fullscreenbutton="false" style="position: relative; opacity: 1; left: 0px; top: 0px;">
            <header role="heading">
                <div class="widget-toolbar" role="menu" rel="popover-hover" data-placement="left" data-original-title="License Count" data-content="Your Xcomms license count is displayed as : Currently Online / Online within the last 24 hours (Active) / Total Licenses Purchased.">
                    <div class="label label-success">
                        <i class="fa fa-users"></i> <span id="OnlineCount">@Model.ListUM.Count(c => c.IsOnline == true)</span>/@Html.DisplayFor(c => c.ActiveUser)/@Html.DisplayFor(c => c.TotalUser)
                    </div>
                </div>
                <div class="jarviswidget-ctrls" role="menu"></div>
                <span class="widget-icon"><i class="fa fa-dashboard"></i> </span>
                <h2>XComms Internal Communications Platform</h2>
            </header>
            <div class="jarviswidget-editbox">
                <input class="form-control" type="text">
            </div>
            <div class="widget-body MainBox">
                <div class="row">
                    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style=" margin-bottom: 10px;">
                        <div class="jarviswidget jarviswidget-color-darken" id="wid-id-1" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false" data-widget-fullscreenbutton="false">
                            <header>
                                <span class="widget-icon"> <i class="fa fa-th-large"></i> </span>
                                <h2>XComms Tools</h2>
                            </header>
                            <div>
                                @if (ststusarray.Length > 0)
                                {

                                    foreach (var mainItem in ststusarray)
                                    {
                                        if (mainItem == "1" || mainItem == "6" || mainItem == "ContentManager")
                                        {
                                            <div class="col col-2 col-md-2 col-sm-6 col-xs-12">
                                                <p class="text-center xcommsToolbar">
                                                    <b><i class="fa fa-exclamation-circle fa-lg"></i>&nbsp;Pop Up Alert</b>
                                                </p>
                                                <a href="@Url.Content("~/Master/CreateAlert?AlertId=0")" class="clsmenu">
                                                    <img src="~/assets/img/Screen/Alerts/5.png" class="img-responsive" />
                                                </a>
                                            </div>
                                        }
                                        if (mainItem == "2" || mainItem == "6" || mainItem == "ContentManager")
                                        {
                                            <div class="col col-2 col-md-2 col-sm-6 col-xs-12">
                                                <p class="text-center xcommsToolbar">
                                                    <b><i class="fa fa-ellipsis-h fa-lg"></i>&nbsp;Scrolling Ticker</b>
                                                </p>
                                                <a href="@Url.Content("~/Master/TickerAlert?TickerID=0")" class="clsmenu">
                                                    <img src="~/assets/img/Screen/Tickers/3.png" class="img-responsive" />
                                                </a>
                                            </div>
                                        }
                                        if (mainItem == "4" || mainItem == "6" || mainItem == "ContentManager")
                                        {
                                            <div class="col col-2 col-md-2 col-sm-6 col-xs-12">
                                                <p class="text-center xcommsToolbar">
                                                    <b><i class="fa fa-desktop fa-lg"></i>&nbsp;Manage Wallpaper</b>
                                                </p>
                                                <a href="@Url.Content("~/Master/AddWallPaper?Type=3&Id=0&Fun=A")" class="clsmenu">
                                                    <img src="~/assets/img/Screen/Wallpaper.png" class="img-responsive" />
                                                </a>
                                            </div>
                                        }
                                        if (mainItem == "3" || mainItem == "6" || mainItem == "ContentManager")
                                        {
                                            <div class="col col-2 col-md-2 col-sm-6 col-xs-12">
                                                <p class="text-center xcommsToolbar">
                                                    <b><i class="fa fa-desktop fa-lg"></i>&nbsp;Manage Screensaver</b>
                                                </p>
                                                <a href="@Url.Content("~/Master/ScreenSaver?Type=4&Id=0&Fun=A")" class="clsmenu">
                                                    <img src="~/assets/img/Screen/ScreenSaver.png" class="img-responsive" />
                                                </a>
                                            </div>
                                        }
                                        if (mainItem == "7" || mainItem == "6" || mainItem == "ContentManager")
                                        {
                                            <div class="col col-2 col-md-2 col-sm-6 col-xs-12">
                                                <p class="text-center xcommsToolbar">
                                                    <b><i class="fa fa-desktop fa-lg"></i>&nbsp;Manage Lockedscreen</b>
                                                </p>
                                                <a href="@Url.Content("~/Master/AddLockScreen?Type=7&Id=0&Fun=A")" class="clsmenu">
                                                    <img src="~/assets/img/Screen/LockScreen.png" class="img-responsive" />
                                                </a>
                                            </div>
                                        }
                                        if (mainItem == "5" || mainItem == "6" || mainItem == "ContentManager")
                                        {
                                            <div class="col col-2 col-md-2 col-sm-6 col-xs-12">
                                                <p class="text-center xcommsToolbar">
                                                    <b><i class="fa fa-comments-o fa-lg"></i>&nbsp;Interactive Tools</b>
                                                </p>
                                                <a href="@Url.Content("~/Master/CreateQuiz")" class="clsmenu">
                                                    <img src="~/assets/img/Screen/Quiz.png" class="img-responsive" />
                                                </a>
                                            </div>
                                        }
                                    }

                                }
                                else
                                {
                                    <div class="col-md-12">
                                        <div class="alert alert-info fade in">
                                            <i class="fa-fw fa fa-info"></i>
                                            <strong>Info !</strong> You have no assigned XComms tools, please contact your management.
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </article>
                </div>
                <div class="row">
                    <article class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                        <div class="jarviswidget jarviswidget-color-darken" id="wid-id-2" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false" data-widget-fullscreenbutton="false">
                            <header>
                                <span class="widget-icon"><i class="fa fa-history"></i></span>
                                <h2>Your Recent XComms Activity</h2>
                            </header>
                            <div class="widget-body no-padding">
                                <table id="dt_SearchAlert" class="table table-striped table-bordered table-hover" width="100%">
                                    <thead>
                                        <tr>
                                            <th class="text-align-center hide">#</th>
                                            @*<th class="text-align-center">Activity Type <i class="fa fa-info-circle txt-color-blue fa-lg"></i></th>*@
                                            <th class="text-left"><i class="fa fa-comments-o txt-color-blueDark fa-lg"></i> Activity Name</th>
                                            <th class="text-center"><i class="fa fa-calendar txt-color-blueDark fa-lg"></i> Date & Time (EST)</th>
                                            <th class="text-center"><i class="fa fa-users txt-color-blueDark fa-lg"></i> Recipients</th>
                                            <th class="text-center"><i class="fa fa-check-circle-o txt-color-blueDark fa-lg"></i> Delivered</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dt_RecentActivityTbody">
                                        @{Html.RenderPartial("_RecentActivity", Model.ListPopAlert);}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </article>
                    <article class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                        <div class="jarviswidget jarviswidget-color-darken" id="wid-id-3" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false" data-widget-fullscreenbutton="false">
                            <header>
                                <span class="widget-icon"><i class="fa fa-user"></i></span>
                                <h2>Search For User ID or Computer Name</h2>
                            </header>
                            <div class="widget-body no-padding">
                                <table id="dt_SearchUser" class="table table-striped table-bordered table-hover" width="100%">
                                    <thead>
                                        <tr>
                                            <th class="text-left"><i class="fa fa-user txt-color-blueDark fa-lg"></i> User ID</th>
                                            <th class="text-left"><i class="fa fa-desktop txt-color-blueDark fa-lg"></i> Computer Name</th>
                                            <th class="text-center">Status</th>
                                            <th class="text-center">Active</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dt_SearchUserTbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </article>
                </div>

            </div>
        </div>
    </article>
</div>
<a href="#exampleModal" data-toggle="modal" id="exampleModals" style="display:none;"></a>
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="row">
                    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12 sortable-grid">
                        <div class="jarviswidget jarviswidget-color-darken" id="wid-id-1" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false" data-widget-fullscreenbutton="false">
                            <header role="heading">
                                <div class="jarviswidget-ctrls" role="menu"></div>
                                <span class="widget-icon"><i class="fa fa-bar-chart"></i></span>
                                <h2>Activity Analytics Report</h2>
                            </header>
                            <div class="row">
                                <div class="col-md-6">
                                    <div id="pie-chart1" class="chart"></div>
                                </div>
                                <div class="col-md-6">
                                    <table class="mrgtop20 table table-responsive table-bordered" id="tblData1"></table>
                                </div>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
            <div class="modal-footer" style="padding:10px !important;">
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        <div class="pull-right">
                            <ul class="demo-btns">
                                <li>
                                    <a href="javascript:void(0);" id="exportpiedata" class="btn btn-labeled btn-primary" rel="tooltip" title="" data-placement="bottom" data-original-title="Export Data">
                                        <span class="btn-label"><i class="fa fa-download"></i></span>Export
                                    </a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" data-dismiss="modal" class="btn btn-labeled btn-danger" rel="tooltip" title="" data-placement="bottom" data-original-title="Close">
                                        <span class="btn-label"><i class="fa fa-close"></i></span>Dismiss
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="exampleModalTbl" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="row">
                    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        <div class="jarviswidget jarviswidget-color-darken" id="wid-id-1" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false" data-widget-fullscreenbutton="false">
                            <header role="heading">
                                <div class="jarviswidget-ctrls" role="menu"></div>
                                <span class="widget-icon"><i class="fa fa-users"></i></span>
                                <h2>List of Recipients</h2>
                            </header>
                            <div>
                                <table class=" mrgtop20 table table-responsive table-bordered" id="tblData2" width="100%"></table>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
            <div class="modal-footer">
                <div class="pull-right">
                    <ul class="demo-btns">
                        <li>
                            <a href="javascript:void(0);" id="exportPopAlert" class="btn btn-labeled btn-primary" rel="tooltip" title="" data-placement="bottom" data-original-title="Export Data">
                                <span class="btn-label"><i class="fa fa-download"></i></span>Export
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" data-dismiss="modal" class="btn btn-labeled btn-danger" rel="tooltip" title="" data-placement="bottom" data-original-title="Close">
                                <span class="btn-label"><i class="fa fa-close"></i></span>Dismiss
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="RemainderModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bggrey">
                <button type="button" class="close" style="font-size: 33px; font-weight: 300; opacity: 1; color: #fff;" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel"><b><i class="fa fa-clock-o"></i> Reminder</b></h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" style="padding:20px 40px;">
                        <h4 style="font-size: 26px !important; color: #a90329;"><strong> We hope you are enjoying XComms.</strong></h4>
                        <p style="margin-top:15px; font-size:16px">
                            <b>
                                Including today you have <span id="days"></span> more days left. Please contact us to extend your XComms access.
                            </b><br /><br />
                            If you have any questions or require any support, please don’t hesitate to reach out to us.
                            <br />
                            We will be available at your convenience.
                        </p>
                        <div class="pull-right">
                            <p style="margin-top: 10px; margin-bottom:0px !important; font-size: 16px; text-align:right"><b>Sincerely,</b><br />The XComms Team</p>
                            <a href="mailto: support@xcomms.com" class="anlink">support@xcomms.com</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="RemainderModalForExpired" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bggrey">
                <button type="button" class="close" style="font-size: 33px; font-weight: 300; opacity: 1; color: #fff;" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel"><b><i class="fa fa-exclamation-triangle"></i> Warning</b></h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" style="padding:20px 40px;">
                        <h4 style="font-size: 26px !important; color: #a90329;"><strong> We hope you enjoyed using XComms.</strong></h4>
                        <p style="margin-top:15px; font-size:16px">
                            <b>
                                Your account is limited to viewing only as your account is currently past it’s expiration.
                            </b><br /><br />
                            To renew your XComms account, please contact us today for assistance.
                            <br />
                            We will be available at your convenience.
                        </p>

                        <div class="pull-right">
                            <p style="margin-top: 10px; margin-bottom:0px !important; font-size: 16px; text-align:right"><b>Sincerely,</b><br />The XComms Team</p>
                            <a href="mailto: support@xcomms.com" class="anlink">support@xcomms.com</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script src="~/assets/plugins/easy-pie-chart/jquery.easy-pie-chart.min.js"></script>
    <script src="~/assets/plugins/flot/jquery.flot.cust.min.js"></script>
    <script src="~/assets/plugins/flot/jquery.flot.resize.min.js"></script>
    <script src="~/assets/plugins/flot/jquery.flot.fillbetween.min.js"></script>
    <script src="~/assets/plugins/flot/jquery.flot.orderBar.min.js"></script>
    <script src="~/assets/plugins/flot/jquery.flot.pie.min.js"></script>
    <script src="~/assets/plugins/flot/jquery.flot.time.min.js"></script>
    <script src="~/assets/plugins/flot/jquery.flot.tooltip.min.js"></script>
}

<script type="text/javascript">

    var FormComponents = function (DomainName) {

        var Formvalidate = function (DomainName) {
            var form1 = $('#form_sample');
            var error1 = $('.alert-danger', form1);
            var success1 = $('.alert-success', form1);
            form1.validate({
                doNotHideMessage: true,
                errorElement: 'span', //default input error message container
                errorClass: 'help-block', // default input error message class
                // errorClass: 'validate-inline',
                focusInvalid: false, // do not focus the last invalid input
                ignore: "",

                rules: {
                },

                messages: {
                },

                invalidHandler: function (event, validator) { //display error alert on form submit
                    success1.hide();
                    error1.show();
                    App.scrollTo(error1, -200);
                },

                highlight: function (element) { // hightlight error inputs
                    $(element)
                        .closest('.form-group').addClass('has-error'); // set error class to the control group
                },

                unhighlight: function (element) { // revert the change done by hightlight
                    $(element)
                        .closest('.form-group').removeClass('has-error'); // set error class to the control group
                },

                success: function (label) {
                    label
                        .closest('.form-group').removeClass('has-error'); // set success class to the control group
                },

                submitHandler: function (form) {
                    success1.show();
                    error1.hide();
                    App.blockUI({ boxed: true });
                    $("#btnSubmit").hide();
                    document.forms["form_sample"].submit();
                }
            });
        }

        var GetAnalytic = function (DomainName) {
            $(".ClsAnalytics").on("click", function () {
                App.blockUI({ boxed: true });
                var strUrl = DomainName + "/Home/GetData";
                var NoOfRecepient = $(this).data('noofrecepient');
                if (NoOfRecepient > 0) {
                    var parameters = {};
                    parameters['Type'] = $(this).data('typeticker');
                    parameters['AlertId'] = $(this).data('alertid');
                    parameters['TenantId'] = '@Model.TenantId';
                    parameters['BaseUserName'] = '@Model.BaseUserName';
                    parameters['ViewingType'] = '@Model.BaseViewingType';

                    var strUrl1 = DomainName + "/Home/ExportData";
                    $('#exportpiedata').attr("href", strUrl1 + "?AlertId=" + $(this).data('alertid') + "&Status=" + "" + "&ModuleType=" + $(this).data('typeticker'));
                    $.ajax({
                        async: true,
                        type: 'POST',
                        url: strUrl,
                        dataType: 'json',
                        data: {
                            Method: 'USP_GetPopUpAnalyticsDataV1',
                            parameters: parameters
                        },
                        success: function (data) {
                            console.log(data)
                            $("#exampleModals").click();
                            setTimeout(function () {
                                if ($('#pie-chart1').length) {
                                    var data_pie = [];

                                    data_pie[0] = {
                                        label: "ND : " + data[0]["NotDelivered"],
                                        data: data[0]["NotDelivered"],
                                    }
                                    data_pie[1] = {
                                        label: "Delivered : " + data[0]["Delivered"],
                                        data: data[0]["Delivered"]
                                    }

                                    $.plot($("#pie-chart1"), data_pie, {
                                        series: {
                                            pie: {
                                                show: true,
                                                innerRadius: 0,
                                                radius: 1,
                                                label: {
                                                    show: true,
                                                    radius: 2 / 4,
                                                    formatter: function (label, series) {

                                                        return '<div style="font-size:11px;text-align:center;color:white;">' + label + '<br/>' + Math.round(series.percent) + '%</div>';
                                                    },
                                                    threshold: 0.1
                                                }
                                            }
                                        },
                                        legend: {
                                            show: false,
                                            noColumns: 1, // number of colums in legend table
                                            labelFormatter: null, // fn: string -> string
                                            labelBoxBorderColor: "#000", // border color for the little label boxes
                                            container: null, // container (as jQuery object) to put legend in, null means default on top of graph
                                            position: "ne", // position of default legend container within plot
                                            margin: [5, 10], // distance from grid edge to default legend container within plot
                                            backgroundColor: "#efefef", // null means auto-detect
                                            backgroundOpacity: 1 // set to 0 to avoid background
                                        },
                                        grid: {
                                            hoverable: true,
                                            clickable: true
                                        },
                                    });

                                    var tblString = "";
                                    tblString += '<tr><td colspan="2"><b>Total Recepient : </b></td><td class="text-left" colspan="2"><b><center>' + data[0]["NoOfRecipientes"] + '</center></b></td></tr>';
                                    tblString += '<tr class="success"><td><div class="squaregreen"></div></td><td><span class="mrgleft5"> <i class="fa fa-check-circle-o txt-color-green fa-md"></i> Delivered</span></td><td><a href="javascript:;" class="ClsAnalTbl" data-alertid="' + data[0]["AlertId"] + '" data-status="Deliverd" data-type="' + data[0]["Type"] + '"><span class="mrgleft10"><b><center>' + data[0]["Delivered"] + '</center></b></span></a></td><td><label>' + data[0]["Delivered_Per"] + '</label></td></tr>';
                                    tblString += '<tr class="danger"><td><div class="squarered"></div></td><td><span class="mrgleft5"> <i class="fa fa-times-circle-o txt-color-red fa-md"></i> Not Delivered</span></td><td><a href="javascript:;" class="ClsAnalTbl" data-alertid="' + data[0]["AlertId"] + '" data-status="NotDeliverd" data-type="' + data[0]["Type"] + '"><span class="mrgleft10"><b><center>' + data[0]["NotDelivered"] + '</center></b></span></a></td><td><label>' + data[0]["NotDelivered_Per"] + '</label></td></tr>';
                                    if (data[0]["Type"] == "1" || data[0]["Type"] == "2" || data[0]["Type"] == "5") {
                                        tblString += '<tr class="warning"><td><div></div></td><td><span class="mrgleft5"> <i class="fa fa-info-circle txt-color-blue fa-md"></i> Acknowleged</span></td><td><a href="javascript:;" class="ClsAnalTbl" data-alertid="' + data[0]["AlertId"] + '" data-status="Acknowleged" data-type="' + data[0]["Type"] + '"><span class="mrgleft10"><b><center>' + data[0]["Acknowledged"] + '</center></b></span></a></td><td><label>' + data[0]["Acknowledged_Per"] + '</label></td></tr>';
                                    }
                                    $("#tblData1").html(tblString);
                                    GetAnalyticDetail(DomainName);
                                    App.unblockUI();
                                }
                            }, 200);
                        },
                        error: function (jqXHR, exception) {
                            TosterNotification("error", errorResult(jqXHR, exception), "Error");
                            App.unblockUI();
                        }
                    });
                }
            });
            GetEmailNotDeliveredRecipientsDetail(DomainName);
            dataTableById("dt_SearchAlert", 2, "desc", true);
        }

        var GetAnalyticDetail = function (DomainName) {
            $(".ClsAnalTbl").on("click", function () {
                App.blockUI({ boxed: true });

                var strUrl = DomainName + "/Master/GetAnalyticData";
                var strUrl1 = DomainName + "/Master/ExportDatadForModal";
                //var strUrl1 = DomainName + "/Home/ExportData";
                $('#exportPopAlert').attr("href", strUrl1 + "?AlertId=" + $(this).data('alertid') + "&Status=" + $(this).data('status') + "&ModuleType=" + $(this).data('type'));
                $.ajax({
                    async: true,
                    type: 'POST',
                    url: strUrl,
                    data: { 'AlertId': $(this).data('alertid'), 'Status': $(this).data('status'), 'ModuleType': $(this).data('type') },
                    success: function (data) {
                        if (data == "1") {
                            App.unblockUI();
                        } else {
                            $("#tblData2").html(data);
                            $('#exampleModalTbl').modal('show');
                            dataTableById("tblData2");
                            App.unblockUI();
                        }
                    },
                    error: function (jqXHR, exception) {
                        TosterNotification("error", errorResult(jqXHR, exception), "Error");
                        App.unblockUI();
                    }
                });
            });
        }

        var GetEmailNotDeliveredRecipientsDetail = function (DomainName) {
            $(".ClsEmailNotDeliveredData").on("click", function () {
                App.blockUI({ boxed: true });
                var strUrl = DomainName + "/Master/GetAnalyticData";
                var strUrl1 = DomainName + "/Home/ExportData";
                var Status = "NotDeliverd";
                $('#exportPopAlert').attr("href", strUrl1 + "?AlertId=" + $(this).data('alertid') + "&Status=" + Status + "&ModuleType=" + $(this).data('type'));
                $.ajax({
                    async: true,
                    type: 'POST',
                    url: strUrl,
                    data: { 'AlertId': $(this).data('alertid'), 'Status': Status, 'ModuleType': $(this).data('type') },
                    success: function (data) {
                        if (data == "1") {
                            App.unblockUI();
                        } else {
                            $("#tblData2").html(data);
                            $('#exampleModalTbl').modal('show');
                            dataTableById("tblData2");
                        }
                        App.unblockUI();
                    },
                    error: function (jqXHR, exception) {
                        TosterNotification("error", errorResult(jqXHR, exception), "Error");
                        App.unblockUI();
                    }
                });
            });
        }

        var Remainder = function (DomainName) {
            var StrUrl = DomainName + "/Home/Remainder";
            $.ajax({
                async: true,
                url: StrUrl,
                type: 'Post',
                data: null,
                success: function (res) {
                    /*if (res[0].PurchasedTrial == "Trial" && res[0].ExpDays > 0)*/
                    if (res[0].ExpDays > 0)
                    {
                        $('#trial').text(res[0].PurchasedTrial);
                        $('#days').text(res[0].ExpDays);
                        @*if (@ViewBag.LastLoginDateDiff > 12) {*@
                        if (res[0].ExpDays <= 10) {
                            $('#RemainderModal').modal('show');
                        }
                        /*}*/
                    }
                    /*if (res[0].PurchasedTrial == "Trial" && res[0].ExpDays == 0)*/
                    if (res[0].ExpDays == 0)
                    {
                        $('#RemainderModalForExpired').modal('show');
                    }
                }
            });
        }

        //var GetOnlineUsers = function (DomainName) {
        //    /*App.blockUI({ target: "#wid-id-3" });*/
        //    var strUrl = DomainName + "/Home/GetOnlineUsers";
        //    $.ajax({
        //        async: true,
        //        type: 'POST',
        //        url: strUrl,
        //        data: { },
        //        success: function (data, textStatus, jqXHR) {
        //            //$('#dt_SearchUser').dataTable().fnClearTable();

        //            $('#dt_SearchUser').dataTable().fnDestroy();
        //            $("#dt_SearchUserTbody").html(data);


                  
        //            pagedDataTableById("dt_SearchUser", 2, "desc", true, GetOnlineUsers, totalRecords);
                   
        //            //GetOnlineUserCount(DomainName);
        //            $("[rel='tooltip']").tooltip();
        //           /* App.unblockUI('#wid-id-3');*/
        //        },
        //        error: function (jqXHR, exception) {
        //            /*App.unblockUI('#wid-id-3');*/
        //        }
        //    });
        //}

        var usersAjaxConfig = {
            url: '/Home/GetOnlineUsers',
            type: 'POST',
            data: function (d) {
                return {
                    draw: d.draw,
                    start: d.start,
                    length: d.length,
                    searchTerm: d.search.value // ✅ This is the correct search term
                };
            },
            dataSrc: function () {
                return []; // Return empty so DataTables doesn't interfere
            },
            complete: function (xhr) {
                var json = xhr.responseJSON;
                $('#OnlineCount').text(json.OnlineCount);

                // Replace the table body with rendered HTML
                // But we use raw JS so DataTables doesn't override
                let tbody = $('#dt_SearchUser tbody');
                tbody.html(json.data); // ✅ inject rows into DOM manually

                if (window.Pace) {
                    Pace.stop(); // ✅ forcefully stop the progress bar
                }
            }
        };

        var GetOnlineUserCount = function (DomainName) {
            var strUrl = DomainName + "/Home/GetOnlineUserCount";
            $.ajax({
                async: true,
                type: 'POST',
                url: strUrl,
                data: {},
                success: function (data) {
                    $('#OnlineCount').text(data);
                },
                error: function (jqXHR, exception) {
                }
            });
        }

        var GetDashboardRecentActivityDetails = function (DomainName) {
            //App.blockUI({ target: "#wid-id-2" });
            var strUrl = DomainName + "/Home/GetDashboardRecentActivityDetails";
            $.ajax({
                async: true,
                type: 'POST',
                url: strUrl,
                data: {},
                success: function (data) {
                    $('#dt_SearchAlert').dataTable().fnClearTable();
                    $('#dt_SearchAlert').dataTable().fnDestroy();

                    //$("#dt_RecentActivityTbody").html('');
                    $("#dt_RecentActivityTbody").html(data);

                    GetAnalytic(DomainName);
                    GetEmailNotDeliveredRecipientsDetail(DomainName);

                    dataTableById("dt_SearchAlert", 2, "desc", true);
                    //App.unblockUI('#wid-id-2');
                },
                error: function (jqXHR, exception) {
                    //App.unblockUI('#wid-id-2');
                }
            });
        }



        return {
            //main function to initiate the module
            init: function (DomainName) {
                App.blockUI({ boxed: true });
                pagedDataTableById("dt_SearchUser", 2, "desc", true, usersAjaxConfig, 4);
                Formvalidate(DomainName); OnlineCount
                Remainder(DomainName);
                //GetAnalytic(DomainName);
                GetDashboardRecentActivityDetails(DomainName);
                //GetOnlineUserCount(DomainName);
                //GetOnlineUsers(DomainName);
                //setInterval(function () {
                //    GetOnlineUsers(DomainName);
                //}, 30000);
                $('.clsmenu').click(function () {
                    App.blockUI({ boxed: true });
                });

                dataTableById("dt_SearchAlert", 2, "desc", true);
                $("[rel='tooltip']").tooltip();

                App.unblockUI();

              
            }
        }
    }();
</script>